#include <iostream>
#include <vector>
#include <conio.h>

class game
{
public:
    game() {}
    game(int n):size(n)
    {
        game_ = true;
        is_zero = false;

        field = new int* [size];
        for (int i(0); i < size; ++i)
        {
            field[i] = new int[size];
        }
        for (int i(0); i < size; ++i)
        {
            for (int j(0); j < size; ++j)
            {
                field[i][j] = 0;
            }
        }

        int k = rand() % size;
        int l = rand() % size;
        //field[k][l] = 2;
        while (1)
        {
            k = rand() % size;
            l = rand() % size;
            if (field[k][l] == 0) break;
        }
        //field[k][l] = 2;
        field[0][0] = 2;
        field[1][0] = 0;
        field[2][0] = 0;
        field[3][0] = 2;

        not_null.reserve(size);
        for (std::pair<int, int> p : not_null)
        {
            p = std::pair<int, int>(0, 0);
        }
    }
    ~game() 
    {
        for (int i(0); i < size; ++i)
        {
            delete[] field[i];
        }
        delete[] field;
        not_null.clear();
    }
    void fill_field();
    void logic(char ch);
    void input();
    void update(char ch);
    void fill_not_null();
    void show();
    bool game_over() 
    {
        /*std::vector<int> v;
        is_zero = false;
        bool is_turn = false;
        for (int i(0); i < size; ++i)
        {
            for (int j(0); j < size; ++j)
            {
                if (field[i][j]) is_zero = false;
                else
                {
                    is_zero = true;
                    break;
                }
                if (i + 1 < size && field[i][j] == field[i + 1][j] && field[i][j] && field[i + 1][j]
                    || field[i][j] == field[i][j + 1] && field[i][j] && field[i][j + 1]
                    || 1
                    || 1) is_turn = true;
            }
        }
        for (int i(0); i < size; ++i)
        {
            for (int j(0); j < size; ++j)
            {
                if (i+1 < size && field[i][j] && field[i+1][j] && field[i][j] == field[i+1][j]) v.push_back(1);
                else if(!is_zero) v.push_back(0);
            }
        }
        for (int i : v) 
        {
            if (i == 1)
            {
                game_ = true;
                break;
            }
            else game_ = false;
        }
        v.clear();*/
        return game_;
    }
private:
    bool is_zero;
    bool game_;
    int** field;
    int size;
    std::vector<std::pair<int, int>> not_null;
};

void game::fill_field()
{
    /*int k = 0, l = 0, i = 0;
    while (1)
    {
        i++;
        k = rand() % size;
        l = rand() % size;
        if (field[k][l] == 0)
        {
            field[k][l] = 2;
            break;
        }
        if (i == size*2) break;
    }*/

    show();
}

void game::input()
{
    char ch = ' ';
    if (_kbhit())
    {
        switch (ch = _getch())
        {
        case 'w':
            ch = 'w';
            update(ch);
            break;
        case 'a':
            ch = 'a';
            update(ch);
            break;
        case 's':
            ch = 's';
            update(ch);

            break;
        case 'd':
            ch = 'd';
            update(ch);
            break;
        default:
            break;
        }
    }
}

void game::update(char ch)
{
    system("cls");
    int cntw = 0;
    int cnta = 0;
    int cnts = 0;
    int cntd = 0;

    for (int i(0); i < size; ++i)
    {
        for (int j(0); j < size; ++j)
        {
                for (int k = 1; k < size; ++k)
                {
                    int l = 0, r = 0, left1 = 0, left2 = 0;
                    if (ch == 'w')
                    {
                        l = i;
                        r = j;
                        left1 = l + k;
                        left2 = l + 1;
                    }
                    else if (ch == 's')
                    {
                        l = size - 1 - i;
                        r = j;
                        left1 = l - k;
                        left2 = l - 1;
                    }
                    if (l == size - 1 && !cntw)
                    {
                        i = 0;
                        l = 0;
                        cntw = 1;
                        if (ch == 'w')
                        {
                            left1 = l + k;
                            left2 = l + 1;
                        }
                        else if (ch == 's')
                        {
                            left1 = l - k;
                            left2 = l - 1;
                        }
                        //std::cout << "\nSWAP\n";
                    }
                    //std::cout << "\n" << l << " + " << k << " = " << left1 << "\n";
                    if (left1 < size && left1 >=0 && l >= 0)
                    {
                        //std::cout << "\n" << i << " " << j << " " << k << "\n";
                        if (field[l][r] && !field[left2][r]) continue;
                        else if (field[l][j] && field[left1][r] && field[l][r] == field[left1][r] && field[l][r] == field[left2][r])
                        {
                            field[l][r] += field[left1][r];
                            field[left1][r] = 0;
                        }
                        else if (!field[l][r] && field[left1][r])
                        {
                            field[l][r] = field[left1][r];
                            field[left1][r] = 0;
                        }
                    }


                }
        }
    }


    /*for (int i(0); i < size; ++i)
    {
        for (int j(0); j < size; ++j)
        {
            if (ch == 'w')
            {
                for (int k = 1; k < size; ++k)
                {
                    if (i == size - 1 && !cntw)
                    {
                        i = 0;
                        cntw = 1;
                    }
                    if (i + k < size)
                    {
                        if (field[i][j] && !field[i + k][j]) continue;
                        else if (field[i][j] && field[i + k][j] && field[i][j] == field[i + k][j] && field[i][j] == field[i+1][j])
                        {
                            field[i][j] += field[i + k][j];
                            field[i + k][j] = 0;
                        }
                        else if(!field[i][j] && field[i+k][j])
                        {
                            field[i][j] = field[i + k][j];
                            field[i + k][j] = 0;
                        }
                    }
                }
            }
            else if (ch == 'a')
            {
                if (j + 1 < size)
                {
                    for (int k = 1; k < size; ++k)
                    {
                        if (j + k < size)
                        {
                            if (!field[i][j + k]) continue;
                            else if (field[i][j] == field[i][j + k])
                            {
                                field[i][j] += field[i][j + k];
                                field[i][j + k] = 0;
                            }
                            else
                            {
                                field[i][j] = field[i][j + k];
                                field[i][j + k] = 0;
                            }
                        }
                    }
                }
            }
            else if (ch == 's')
            {
                    for (int k = 1; k < size; ++k)
                    {
                        if (i == size -1 && !cnts)
                        {
                            i = 0;
                            cnts = 1;
                        }
                        if (size - 1 - i - k >= 0)
                        {
                            if (size - 1 - i >= 0 && size - i - 2 < size)
                            {
                                if (field[size - 1 - i][j] && !field[size - 1 - i - k][j]) continue;
                                else if (field[size - 1 - i][j] && field[size - 1 - i - k][j] && field[size - 1 - i][j] == field[size - 1 - i - k][j]
                                    && field[size-1-i][j] == field[size-2-i][j])
                                {
                                    field[size - 1 - i][j] += field[size - 1 - i - k][j];
                                    field[size - 1 - i - k][j] = 0;
                                }

                                else if (!field[size - 1 - i][j] && field[size - 1 - i - k][j])
                                {
                                    field[size - 1 - i][j] = field[size - 1 - i - k][j];
                                    field[size - 1 - i - k][j] = 0;
                                }

                            }
                        }
                    }                   
            }
            else if (ch == 'd')
            {
                if (j - 1 >= 0)
                {
                    if (field[i][j] == field[i][j - 1] && field[i][j] && field[i][j - 1])
                    {
                        field[i][j] += field[i][j - 1];
                        field[i][j - 1] = 0;
                    }
                    if (field[i][j - 1])
                    {
                        field[i][j] = field[i][j - 1];
                        field[i][j - 1] = 0;
                    }
                }
            }
        }
    }*/
    fill_field();
}

void game::fill_not_null()
{
    for (int i(0); i < size; ++i)
    {
        for (int j(0); j < size; ++j)
        {
            if (!field[i][j]) not_null.push_back(std::pair<int, int>(i, j));
        }
    }
}

void game::show()
{
    for (int i(0); i < size; ++i)
    {
        for (int j(0); j < size; ++j)
        {
            std::cout << " [ " << field[i][j] << " ] ";
        }
        std::cout << "\n";
    }
}


int main(int argc, char** argv)
{
    //srand(time(NULL));
    int n = 4;
    game g(n);
    g.show();
    while (g.game_over())
    {
        g.input();
    }
    if (!g.game_over()) std::cout << "You loose :(\n";
            
    return 0;
}











/*std::string func(std::string s);

int main(int argc, char* argv[])
{
    std::string s;
    s = "C:\\Users\\eemee\\Desktop\\Instagram\\heg.jpg";
    std::cout << func(s);

    return 0;
}

std::string func(std::string s)
{
    std::string str;
    std::string str2;
    int k = 1;
    for (int i(s.size()); i > 0; --i)
    {
        if (s[i] == '.') 
        { 
            while(s[i-k]!='\\')
            {
                str2 = s[i - k];
                str.insert(0, str2);
                k++;
            }
        }
    }
    //without cycles, conditional var, stl 2048 n*n
    return str;
}*/


/*void func(int* arr, int size, int i)
{
    int sum = 0;
    if(i+1 < size)
        int sum = arr[i] + arr[i + 1];
    if (sum % 3 == 0) std::cout << sum;
    else func(arr, size, i++);

}*/


/*
const int size = 10;
int arr[size] = {};
for (int* p = arr; p < arr + size; ++p)
{
    *p = rand()%10 + 1;
}
for (int* p = arr; p < arr + size; ++p)
{
    std::cout << *p << " ";
}
std::cout << "\n";
int i = 0;
func(arr, size, i);
*/
